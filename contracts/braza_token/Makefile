# =====================================================================
# ğŸš€ BRAZA TOKEN - MAKEFILE OFICIAL (COM CORES ğŸ¨)
# =====================================================================

# Cores ANSI
GREEN  := \033[32m
YELLOW := \033[33m
BLUE   := \033[34m
CYAN   := \033[36m
MAG	:= \033[35m
RED	:= \033[31m
RESET  := \033[0m

CONTRACT_NAME := braza_token
TARGET := wasm32-unknown-unknown
WASM_PATH := target/$(TARGET)/release/$(CONTRACT_NAME).wasm

# ğŸŒ Rede
NETWORK := testnet

# ğŸ“‚ Scripts
SCRIPTS := ./scripts

# =====================================================================
# ğŸ”¨ BUILD
# =====================================================================

.PHONY: build
build:
	@echo "$(BLUE)ğŸ”¨ Compilando contrato...$(RESET)"
	cargo build --release --target $(TARGET)
	@echo "$(GREEN)âœ” Build concluÃ­do: $(WASM_PATH)$(RESET)"

.PHONY: optimize
optimize:
	@echo "$(MAG)âœ¨ Otimizando WASM...$(RESET)"
	wasm-opt -Oz $(WASM_PATH) -o $(WASM_PATH)
	@echo "$(GREEN)âœ” OtimizaÃ§Ã£o concluÃ­da!$(RESET)"

.PHONY: build-opt
build-opt: build optimize
	@echo "$(CYAN)ğŸ Build + OtimizaÃ§Ã£o completos!$(RESET)"

# =====================================================================
# ğŸš€ DEPLOY
# =====================================================================

.PHONY: deploy
deploy: build-opt
	@echo "$(CYAN)ğŸ“¦ Iniciando deploy...$(RESET)"
	$(SCRIPTS)/deploy.sh

.PHONY: initialize
initialize:
	@echo "$(CYAN)ğŸ§­ Inicializando contrato...$(RESET)"
	$(SCRIPTS)/initialize.sh

.PHONY: verify
verify:
	@echo "$(CYAN)ğŸ” Verificando contrato...$(RESET)"
	$(SCRIPTS)/verify.sh

.PHONY: deploy-all
deploy-all:
	@echo "$(CYAN)ğŸš€ Executando pipeline completo: build â†’ deploy â†’ init â†’ verify$(RESET)"
	$(SCRIPTS)/deploy-all.sh

# =====================================================================
# ğŸ¨ FORMAT / LINT
# =====================================================================

.PHONY: fmt
fmt:
	@echo "$(YELLOW)ğŸ¨ Formatando cÃ³digo...$(RESET)"
	cargo fmt
	@echo "$(GREEN)âœ” CÃ³digo formatado$(RESET)"

.PHONY: lint
lint:
	@echo "$(YELLOW)ğŸ§¹ Rodando Clippy...$(RESET)"
	cargo clippy --all-targets --all-features -- -D warnings
	@echo "$(GREEN)âœ” Lint concluÃ­do sem warnings$(RESET)"

# =====================================================================
# ğŸ§ª TESTES
# =====================================================================

.PHONY: test
test:
	@echo "$(RED)âš  Testes ainda serÃ£o implementados.$(RESET)"
	# cargo test

.PHONY: test-int
test-int:
	@echo "$(RED)âš  Testes de integraÃ§Ã£o ainda serÃ£o implementados.$(RESET)"
	# cargo test --test '*'

# =====================================================================
# ğŸ› ï¸ UTILIDADES
# =====================================================================

.PHONY: clean
clean:
	@echo "$(YELLOW)ğŸ—‘ Limpando diretÃ³rio target...$(RESET)"
	cargo clean
	@echo "$(GREEN)âœ” Limpeza concluÃ­da$(RESET)"

.PHONY: info
info:
	@echo "$(CYAN)ğŸ“Œ InformaÃ§Ãµes do Projeto:$(RESET)"
	@echo "   â€¢ Contrato: $(CONTRACT_NAME)"
	@echo "   â€¢ Rede: $(NETWORK)"
	@echo "   â€¢ WASM: $(WASM_PATH)"

# =====================================================================
# â“ AJUDA
# =====================================================================

.PHONY: help
help:
	@echo ""
	@echo "$(GREEN)ğŸ“˜ BRAZA TOKEN - Comandos DisponÃ­veis$(RESET)"
	@echo ""
	@echo "$(BLUE)ğŸ”¨ build$(RESET)		   â†’ Compila o contrato"
	@echo "$(BLUE)âš™ optimize$(RESET)		â†’ Otimiza o WASM"
	@echo "$(BLUE)ğŸš€ build-opt$(RESET)	   â†’ Build + otimizaÃ§Ã£o"
	@echo ""
	@echo "$(CYAN)ğŸ“¦ deploy$(RESET)		  â†’ Deploy do contrato"
	@echo "$(CYAN)ğŸ§­ initialize$(RESET)	  â†’ Inicializar contrato"
	@echo "$(CYAN)ğŸ” verify$(RESET)		  â†’ Verificar deploy"
	@echo "$(CYAN)ğŸš€ deploy-all$(RESET)	  â†’ Pipeline completo"
	@echo ""
	@echo "$(YELLOW)ğŸ¨ fmt$(RESET)			 â†’ Formatador Rust"
	@echo "$(YELLOW)ğŸ§¹ lint$(RESET)			â†’ Clippy (warning = erro)"
	@echo "$(YELLOW)ğŸ—‘ clean$(RESET)		   â†’ Limpar target/"
	@echo "$(YELLOW)â„¹ info$(RESET)			â†’ Exibir informaÃ§Ãµes"
	@echo ""
	@echo "$(MAG)ğŸ§ª test$(RESET)			 â†’ Testes unitÃ¡rios (futuro)"
	@echo "$(MAG)ğŸ§ª test-int$(RESET)		 â†’ Testes de integraÃ§Ã£o (futuro)"
	@echo ""
	@echo "$(GREEN)â“ help$(RESET)			â†’ Exibe esta ajuda"
	@echo ""
